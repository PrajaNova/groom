openapi: 3.1.0
info:
  title: Groom MS API
  version: 1.0.0
  description: API for Grooming and Booking Microservice
servers:
  - url: http://localhost:3000
    description: Development
components:
  schemas:
    Error:
      type: object
      properties:
        statusCode:
          type: number
          example: 400
        error:
          type: string
          example: Bad Request
        message:
          type: string
          example: Validation failed
      required:
        - statusCode
        - error
        - message
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
      required:
        - success
        - message
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        name:
          type: string
        avatar:
          type:
            - string
            - "null"
        createdAt:
          type: string
          format: date
        updatedAt:
          type: string
          format: date
        roles:
          type: array
          items:
            type: string
      required:
        - id
        - email
        - name
        - createdAt
        - updatedAt
    Session:
      type: object
      properties:
        sessionId:
          type: string
        userId:
          type: string
        expiresAt:
          type:
            - string
            - "null"
          format: date
        device:
          type: string
        userAgent:
          type: string
        ipAddress:
          type: string
        createdAt:
          type:
            - string
            - "null"
          format: date
        isCurrent:
          type: boolean
          default: false
      required:
        - sessionId
        - userId
        - expiresAt
        - createdAt
    AuthResponse:
      type: object
      properties:
        user:
          $ref: "#/components/schemas/User"
        sessionToken:
          type: string
      required:
        - user
        - sessionToken
    SessionResponse:
      type: object
      properties:
        sessionId:
          type: string
        userId:
          type: string
        expiresAt:
          type:
            - string
            - "null"
          format: date
        device:
          type: string
        userAgent:
          type: string
        ipAddress:
          type: string
        createdAt:
          type:
            - string
            - "null"
          format: date
        isCurrent:
          type: boolean
          default: false
      required:
        - sessionId
        - userId
        - expiresAt
        - createdAt
    UserProfileResponse:
      type: object
      properties:
        user:
          $ref: "#/components/schemas/User"
        session:
          $ref: "#/components/schemas/SessionResponse"
      required:
        - user
        - session
    RegisterRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
          maxLength: 100
        name:
          type: string
          minLength: 2
          maxLength: 100
        avatar:
          type: string
          format: uri
      required:
        - email
        - password
        - name
    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 1
      required:
        - email
        - password
    Provider:
      type: object
      properties:
        name:
          type: string
        displayName:
          type: string
        icon:
          type: string
        enabled:
          type: boolean
      required:
        - name
        - displayName
        - icon
        - enabled
    ProviderListResponse:
      type: array
      items:
        $ref: "#/components/schemas/Provider"
    Role:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type:
            - string
            - "null"
        createdAt:
          type: string
          format: date
        updatedAt:
          type: string
          format: date
      required:
        - id
        - name
        - createdAt
        - updatedAt
    RoleCreate:
      type: object
      properties:
        name:
          type: string
          minLength: 2
        description:
          type: string
      required:
        - name
    RoleListResponse:
      type: array
      items:
        $ref: "#/components/schemas/Role"
    AssignRole:
      type: object
      properties:
        roleId:
          type: string
          format: cuid
      required:
        - roleId
    Blog:
      type: object
      properties:
        id:
          type: string
          format: uuid
        slug:
          type: string
        title:
          type: string
        content:
          type: string
        excerpt:
          type:
            - string
            - "null"
        author:
          type:
            - string
            - "null"
        category:
          type:
            - string
            - "null"
        imageSeed:
          type:
            - string
            - "null"
        readTime:
          type: integer
        publishedAt:
          type:
            - string
            - "null"
          format: date-time
        createdAt:
          anyOf:
            - type: string
              format: date-time
            - type: string
              format: date
        updatedAt:
          anyOf:
            - type: string
              format: date-time
            - type: string
              format: date
      required:
        - id
        - slug
        - title
        - content
        - createdAt
        - updatedAt
    CreateBlogRequest:
      type: object
      properties:
        slug:
          type: string
        title:
          type: string
        content:
          type: string
        excerpt:
          type: string
        author:
          type: string
        category:
          type: string
        imageSeed:
          type: string
        readTime:
          type: number
      required:
        - slug
        - title
        - content
    UpdateBlogRequest:
      type: object
      properties:
        slug:
          type: string
        title:
          type: string
        content:
          type: string
        excerpt:
          type: string
        author:
          type: string
        category:
          type: string
        imageSeed:
          type: string
        readTime:
          type: number
    BlogListResponse:
      type: array
      items:
        $ref: "#/components/schemas/Blog"
    Booking:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          minLength: 2
        email:
          type: string
          format: email
        when:
          anyOf:
            - type: string
              format: date-time
            - type: string
              format: date
        reason:
          type: string
        userId:
          type:
            - string
            - "null"
        status:
          type: string
          enum:
            - pending
            - confirmed
            - completed
            - cancelled
        meetingId:
          type:
            - string
            - "null"
        createdAt:
          anyOf:
            - type: string
              format: date-time
            - type: string
              format: date
        updatedAt:
          anyOf:
            - type: string
              format: date-time
            - type: string
              format: date
      required:
        - id
        - name
        - email
        - when
        - reason
        - status
        - createdAt
        - updatedAt
    CreateBookingRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 2
        email:
          type: string
          format: email
        when:
          type: string
          format: date-time
        reason:
          type: string
      required:
        - name
        - email
        - when
    BookingListResponse:
      type: array
      items:
        $ref: "#/components/schemas/Booking"
    BookingQuery:
      type: object
      properties:
        email:
          type: string
          format: email
        userId:
          type: string
        status:
          type: string
        fromDate:
          type: string
          format: date-time
        sort:
          type: string
          enum:
            - asc
            - desc
    Confession:
      type: object
      properties:
        id:
          type: string
          format: uuid
        content:
          type: string
        createdAt:
          anyOf:
            - type: string
              format: date-time
            - type: string
              format: date
      required:
        - id
        - content
        - createdAt
    CreateConfessionRequest:
      type: object
      properties:
        content:
          type: string
          minLength: 1
      required:
        - content
    ConfessionListResponse:
      type: array
      items:
        $ref: "#/components/schemas/Confession"
    JaasTokenRequest:
      type: object
      properties:
        meetingId:
          type: string
          minLength: 1
      required:
        - meetingId
    JaasTokenResponse:
      type: object
      properties:
        token:
          type: string
      required:
        - token
  parameters: {}
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
paths:
  /api/auth/register:
    post:
      tags:
        - Auth
      summary: Register a new user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/RegisterRequest"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/auth/login:
    post:
      tags:
        - Auth
      summary: Login user
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/auth/logout:
    post:
      tags:
        - Auth
      summary: Logout user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                required:
                  - success
                  - message
  /api/auth/me:
    get:
      tags:
        - Auth
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Current user profile
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
  /api/auth/providers:
    get:
      tags:
        - Auth
      summary: Get OAuth providers
      responses:
        "200":
          description: List of providers
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProviderListResponse"
  /api/blogs:
    get:
      tags:
        - Blogs
      summary: Get all blogs
      responses:
        "200":
          description: List of blogs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Blog"
    post:
      tags:
        - Blogs
      summary: Create a blog post
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBlogRequest"
      responses:
        "201":
          description: Blog created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Blog"
  /api/blogs/{slug}:
    get:
      tags:
        - Blogs
      summary: Get blog by slug
      parameters:
        - schema:
            type: string
          required: true
          name: slug
          in: path
      responses:
        "200":
          description: Blog details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Blog"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /api/bookings:
    get:
      tags:
        - Bookings
      summary: Get bookings
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
            format: email
          required: false
          name: email
          in: query
        - schema:
            type: string
          required: false
          name: userId
          in: query
        - schema:
            type: string
          required: false
          name: status
          in: query
        - schema:
            type: string
            format: date-time
          required: false
          name: fromDate
          in: query
        - schema:
            type: string
            enum:
              - asc
              - desc
          required: false
          name: sort
          in: query
      responses:
        "200":
          description: List of bookings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Booking"
    post:
      tags:
        - Bookings
      summary: Create booking
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateBookingRequest"
      responses:
        "201":
          description: Booking created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Booking"
  /api/bookings/{id}:
    get:
      tags:
        - Bookings
      summary: Get booking by ID
      security:
        - bearerAuth: []
      parameters:
        - schema:
            type: string
          required: true
          name: id
          in: path
      responses:
        "200":
          description: Booking details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Booking"
  /api/confessions:
    get:
      tags:
        - Confessions
      summary: Get recent confessions
      responses:
        "200":
          description: List of confessions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Confession"
    post:
      tags:
        - Confessions
      summary: Create confession
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateConfessionRequest"
      responses:
        "201":
          description: Confession created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Confession"
  /api/jaas:
    post:
      tags:
        - JaaS
      summary: Generate Jitsi token
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JaasTokenRequest"
      responses:
        "200":
          description: Token generated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JaasTokenResponse"
  /api/roles:
    get:
      tags:
        - Roles
      summary: Get all roles
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of roles
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoleListResponse"
webhooks: {}
